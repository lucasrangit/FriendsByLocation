{% extends "base.html" %}
{% block title %}Locations{% endblock %}
{% block content %}
  {% if user %}

    <div class="container-fluid">

      <div class="row-fluid">

        <div class="col-md-4 col-lg-4">

          <ul class="list-group">
            <li class="list-group-item active">
              <b>1st degree friends: {{ friends_count }}</b>
            </li>
            {% for item in locations %}
              <li class="list-group-item">
                <span class="badge">{{ item[1].count }}</span>
                <span class="location" data-location-id="{{ item[0] }}">{{ item[1].name }}</span>
              </li>
            {% endfor %}
          </ul>

        </div>

      </div>

      <div class="row-fluid">

        <div class="col-md-4 col-lg-4">

          <ul class="list-group">
            <li class="list-group-item active">
              <b>2nd degree friends: {{ friends_count_2 }}</b>
            </li>
            {% for item in locations_2 %}
              <li class="list-group-item">
                <span class="badge">{{ item[1].count }}</span>
                <span class="location" data-location-id="{{ item[0] }}">{{ item[1].name }}</span>
              </li>
            {% endfor %}
          </ul>

        </div>

      </div>

    </div>

    </div>
    <script>
      $('.location').click(function(){
            var item = $(this);
            var text_to_insert = ' <img src="/static/images/loading.gif" /> ';
            $.post(
              "/prefs",
              {
                location: $(this).attr('data-location-id'),
                beforeSend: function(){
                  $(item).append($(text_to_insert));
                },
              },
              function() {
                  window.location.assign("/friends");
              }
            );
      });
    </script>

    <style>
      #map-container { height: 300px }
    </style>

    <script src="http://maps.google.com/maps/api/js?key={{google_maps_api_key}}&sensor=false"></script>
    <script type="text/javascript">
      var data = [[50.1142, .12231, "MarkerName"], [49.131, -.12232, "MarkerName2"], [48.131, -.12232, "MarkerName3"]]; 
      $(document).ready(function () {
                        var latitude = parseFloat("51.515252");
                        var longitude = parseFloat("-0.189852");
                        var latlngPos = new google.maps.LatLng(latitude, longitude);
                        // Set up options for the Google map
                        var myOptions = {
                        zoom: 10,
                        center: latlngPos,
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                        };
                        // Define the map
                        map = new google.maps.Map(document.getElementById("map"), myOptions);
                        data.forEach(function(p) {
                            var point = new google.maps.LatLng(p.lat, p.lng);
                            var marker = new google.maps.Marker({position: point,
                                              map: map,
                                              title: p.name
                                              });
                               })
                        });
    </script>
    <div id="map-container" class="col-md-6"></div>

  {% endif %}
{% endblock %}
